description: >
  This command runs sonar analysis on a maven project.

parameters:
  mvn_opts:
    type: string
    default: ''
    description: >
      Maven command line override options,
      helpful to centralize private repo config like (-s .circleci/mvn-settings.xml).
  project_key:
    type: string
    default: ${CIRCLE_PROJECT_REPONAME}
    description: >
      Sonar project key (set this at your sonarcloud account and supply here). Default is project repo name.
  token:
    type: string
    default: ''
    description: >
      Provide sonar login token (create this at your sonarcloud account).

steps:
  - run:
      environment:
        MVN_OPTS: << parameters.mvn_opts >>
        PROJECT_KEY: << parameters.project_key >>
        TOKEN: << parameters.token >>
      name: Analyze and publish code coverage report.
      command: <<include(scripts/sonar-analyze.sh)>>
